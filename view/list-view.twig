<html>
<head>
    <meta charset="UTF-8">
    <title>全部用户信息</title>
</head>
<script language="JavaScript" type="text/javascript">
    var xmlhttp;
    var select;
  /*  var obj=document.getElementById("serch");
    obj.addEventListener("click",Serchuser,false);
*/
    function createXmlHttpRequest()
    {
        if(window.ActiveXObject)
        {
            xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
        }
        else if(window.XMLHttpRequest)
        {
            xmlhttp=new XMLHttpRequest();
        }
        return xmlhttp;
    }
    function Serchuser(){
        /*var sex=function () {
            for(var i=0;i<document.getElementsByName("sex").length;i++)
            {
                if(document.getElementsByName('sex')[i]==true)
                    return document.getElementsByName('sex')[i].value;
            }

        }*/
        //alert("1");
        var sex=null;
            for(var i=0;i<document.getElementsByName("sex").length;i++)
            {
                if(document.getElementsByName('sex')[i]==true)
                    sex=document.getElementsByName('sex')[i].value;
                    return sex;
            }

        alert("1");
        //alert(select);
        createXmlHttpRequest();
        if(sex())
        {  url="?controller=User&action=serchuser";
            xmlhttp.onreadystatechange=request_serch;
            xmlhttp.open("POST",url,true);
            xmlhttp.send({
                    'sex':sex,
                    'agel':document.getElementById('agel').value,
                    'ager':document.getElementById('ager').value
                }

            );
        }

    }
    function request_serch() {
        if (xmlhttp.readyState == 4){
            if (xmlhttp.status == 200) {
                //alert(xmlhttp.responseText);
                window.location="?controller=User&action=serchuser";
            }

        }


    }
    function send_request(){

        select=document.getElementById("select").value;
        createXmlHttpRequest();
            var url="?controller=User&action=list&select="+select;
            xmlhttp.onreadystatechange=processRequest;
            xmlhttp.open("GET",url,true);
            xmlhttp.send(null)


        //alert(url);
    }
    function processRequest() {
        if (xmlhttp.readyState == 4){
            if (xmlhttp.status == 200) {
                window.location="?controller=User&action=list&select="+select;
            }

    }
    }
    function getQueryUrl(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return decodeURIComponent(r[2]); return null;
    }
    function changsele() {
         alert(document.getElementById("select").value);
    }
    function getPage() {

        //(document.getElementById("getpage").value);
        window.location="?controller=User&action=list&page="+document.getElementById("page").value;

    }


    window.onload=function () {

        //alert(getQueryUrl('select'));
        if(getQueryUrl('select')=="女")
            document.getElementById("select").value="女";
        if(getQueryUrl('select')=="男")
            document.getElementById("select").value="男";
        var page=getQueryUrl('page');
        //alert(page);
        if(getQueryUrl('page'))
            document.getElementById("page").value=page;


    }



</script>
<style>
    .div1{
        position: absolute;
        width: 60%;
        left: 20%;
        text-align: center;
    }
    .table{
        width: 100%;
    }
    .nas select{
        float: left;
    }
    .selesex{


    }
    .seachuser{
        position: inherit;
        float: right;
        left: 60px;

    }

    </style>
<body align="center">
<h2 align="center">查询结果</h2>

    <form action="index.php?controller=User&action=sle" method="post">
        <label for="name"></label>
        <input type="text" name="sele" id="name"  value="请输入用户名或用ID">
        <input type="submit" value="查询">
        <a href="index.html"><input type="button" value="返回首页"></a>
    </form><hr>
    <div  class="div1" >
        <div class="nas">
            <div class="selesex">
                <select name="select" id="select" onchange="send_request()">
                    <option value="" >选择显示类型</option>
                <option value="0" >全部显示</option>
                <option value="男"  >男</option>
                <option value="女">女</option>
                 </select>
            </div>
            <div class="seachuser">
                <form name="serchuser" method="post" action="?controller=User&action=serchuser">
                    <label for="sex1">男</label>
                    <input type="radio" id="sex1" name="sex" value="男">
                    <label for="sex２">女</label>
                    <input type="radio" id="sex２" name="sex" value="女">
                <input type="text" value="1" id="agel" name="agel">-
                <input type="text" value="88" id="ager" name="ager">
                    <input name="submit" type="submit" id="serch" value="查询">
                </form>
            </div>

        </div>
            <table border="1px" class="table">

                {% if users %}
                <thead>
                <td>id</td>
                <td>姓名</td>
                <td>性别</td>
                <td>年龄</td>
                <td>简介</td>
                <td>

                </td>
                </thead>
                <tbody>
            {% for user in users %}

        <tr>
            <td>{{ user.id }}</td>
            <td>{{ user.name }}</td>
            <td>{{ user.sex }}</td>
            <td>{{ user.age }}</td>
            <td>{{ user.comment }}</td>
            <td><a href="?controller=User&action=modify&id={{ user.id }}"><input type="button" value="修改"></a>&nbsp;&nbsp;
                <a href="?controller=User&action=del&id={{ user.id }}"><input type="button" value="删除"></a>
            </td>
        </tr>
            {% endfor %}
            {% endif %}

         </tbody>
            </table>
                <p>
            {% if num %}
                <span>总{{ num }}用户</span>
            {% endif %}
            {% if num>page_show %}
            {% if page %}
                {% set pagenow=page %}
                <span>第{{ pagenow }}/{{ pagenum }}页</span>
                <a href="?controller=User&action=list&page=１">首页</a>
                {% if pagelast %}
                <a href="?controller=User&action=list&page={{  pagelast }}">上一页</a>
                    {% endif %}
                {% if pagenext %}
                <a href="?controller=User&action=list&page={{  pagenext  }}">下一页</a>
                    {% endif %}
                <a href="?controller=User&action=list&page={{  pagenum }}">末页</a>
                <select name="page" id="page" onchange="getPage()">
                    {% set page=1 %}
                    {% for page in 1..pagenum %}
                    <option value={{ page }} >{{ page }}</option>

                    {% endfor %}
                </select>
            {% endif %}
            {% endif %}

</p>
</div>
</body>
</html>






